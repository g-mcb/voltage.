<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>voltage. | chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
body,input,button,.message,.suggestion{font-family:"Ubuntu",sans-serif!important;font-weight:700}
:root{--blue:#003da5;--blue-dark:#002f82;--white:#fff;--muted:#cdd8ff;--purple:#7c3aed;}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--blue);color:#fff;height:100vh;display:flex;flex-direction:column}

nav.navbar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:var(--blue-dark)}
.nav-left .nav-logo{color:#003da5;text-decoration:underline;font-weight:bold;}
.nav-left .nav-logo i{margin-right:6px;}
.nav-right a.nav-link{color:#fff;text-decoration:none;margin-left:16px;}
.nav-right .nav-dropdown{position:relative;display:inline-block;margin-left:16px;}
.nav-dropdown .dropdown-menu{display:none;position:absolute;top:100%;background:var(--blue-dark);border-radius:6px;overflow:hidden}
.nav-dropdown:hover .dropdown-menu{display:block}
.nav-dropdown .dropdown-menu a{display:block;padding:8px 12px;color:#fff;text-decoration:none;}
.nav-dropdown .dropdown-menu a:hover{background:rgba(255,255,255,0.1)}

.hero{text-align:center;margin-top:60px;position:relative;z-index:1}
.hero h1{font-size:64px;font-weight:800}

.chat-wrapper{flex:1;display:flex;justify-content:center;align-items:flex-start;padding:20px 16px;gap:16px;flex-wrap:wrap}

.chat{width:100%;max-width:720px;background:var(--blue-dark);border-radius:14px;display:flex;flex-direction:column;overflow:hidden}
.chat-body{flex:1;padding:16px;overflow-y:auto;min-height:300px}

.message{margin-bottom:12px;line-height:1.5;font-size:15px;position:relative;padding:6px 12px;border-radius:6px;word-break:break-word}
.user-message{text-align:right;background:rgba(255,255,255,.05)}
.ai-message{background:rgba(255,255,255,.05);color:var(--muted)}

.chat-input{display:flex;gap:4px;padding:4px;border-top:1px solid #ffffff22;align-items:center}
.chat-input input{flex:1;padding:12px;background:transparent;border:none;color:#fff;font-size:15px}
.chat-input button{width:40px;height:40px;background:transparent;border:none;color:#fff;cursor:pointer}
.clear-btn{color:#ff4b4b}

img{max-width:100%;border-radius:6px;margin-top:6px}
.footer{text-align:center;font-size:12px;opacity:.7;padding:10px}

.new-chat-btn{
  background: var(--purple);
  color: #fff;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  transition: background 0.2s ease;
  display:flex;
  align-items:center;
  gap:6px;
}
.new-chat-btn:hover{background:#5a23b5}

#authPanel{margin-bottom:16px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
#authPanel input{padding:8px;border-radius:6px;border:none;flex:1;min-width:120px}
#authPanel button{padding:8px 12px;border-radius:6px;border:none;background:var(--purple);color:#fff;cursor:pointer;font-weight:700}
#authPanel button:hover{background:#5a23b5}
</style>
</head>
<body>

<nav class="navbar">
  <div class="nav-left">
    <a href="/" class="nav-logo">
      <i class="fa-solid fa-bolt"></i> voltage.
    </a>
  </div>
  <div class="nav-right">
    <a href="/games.html" class="nav-link"><i class="fa-solid fa-gamepad"></i> Games</a>
    <a href="/ai.html" class="nav-link"><i class="fa-solid fa-robot"></i> AI</a>
    <div class="nav-dropdown">
      <span class="nav-link"><i class="fa-solid fa-comments"></i> Chat <i class="fa-solid fa-caret-down"></i></span>
      <div class="dropdown-menu">
        <a href="/server1.html"><i class="fa-solid fa-server"></i> Server 1</a>
        <a href="/server2.html"><i class="fa-solid fa-server"></i> Server 2</a>
      </div>
    </div>
  </div>
</nav>

<div class="hero"><h1>voltage.</h1></div>

<div id="authPanel">
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn">Login</button>
</div>

<div class="chat-wrapper">
  <div class="chat">
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input">
      <button class="clear-btn" id="clearChatBtn"><i class="fa-solid fa-trash"></i></button>
      <input id="chatInput" placeholder="Type a message...">
      <button class="new-chat-btn" id="newChatBtn"><i class="fa-solid fa-plus"></i> New Chat</button>
      <button id="sendMsgBtn"><i class="fas fa-arrow-up"></i></button>
    </div>
  </div>
</div>

<div class="footer">
  Credit to <a href="https://petezahgames.com/" style="color:#fff">PeteZah</a>
</div>

<script>
const API_BASE = "https://dsc-dmgc.onrender.com";
let token = null;
let threads = [];
let currentThread = null;
const chatBody = document.getElementById("chatBody");
const chatInput = document.getElementById("chatInput");

// ===== Auth =====
document.getElementById("signupBtn").onclick = async ()=>{
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  if(!username || !password) return alert("Enter username/password");
  const res = await fetch(API_BASE+"/user/signup", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,password})
  }).then(r=>r.json());
  if(res.success){ token=res.token; loadThreads(); }
  else alert("Signup failed: "+(res.error||"Unknown"));
}

document.getElementById("loginBtn").onclick = async ()=>{
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  if(!username || !password) return alert("Enter username/password");
  const res = await fetch(API_BASE+"/user/login", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,password})
  }).then(r=>r.json());
  if(res.success){ token=res.token; loadThreads(); }
  else alert("Login failed: "+(res.error||"Unknown"));
}

// ===== Threads =====
async function loadThreads(){
  const res = await fetch(API_BASE+"/threads",{headers:{Authorization:"Bearer "+token}}).then(r=>r.json());
  threads=res;
  renderThreads();
}

function renderThreads(){
  chatBody.innerHTML="";
  threads.forEach(t=>{
    const div=document.createElement("div");
    div.textContent=t.name;
    div.style.cursor="pointer";
    div.style.padding="6px 12px";
    div.style.background="rgba(255,255,255,0.05)";
    div.style.marginBottom="4px";
    div.style.borderRadius="6px";
    div.onclick=()=>loadMessages(t._id);
    chatBody.appendChild(div);
  });
}

// ===== Messages =====
async function loadMessages(threadId){
  currentThread=threadId;
  const msgs = await fetch(`${API_BASE}/message/${threadId}/messages`,{headers:{Authorization:"Bearer "+token}}).then(r=>r.json());
  chatBody.innerHTML="";
  msgs.forEach(m=>{
    const div=document.createElement("div");
    div.className=m.username===document.getElementById("username").value?"message user-message":"message ai-message";
    div.textContent=m.username+": "+m.content;
    chatBody.appendChild(div);
  });
  chatBody.scrollTop=chatBody.scrollHeight;
}

// ===== Send Message =====
document.getElementById("sendMsgBtn").onclick = async ()=>{
  if(!currentThread) return alert("Select a thread first");
  const content = chatInput.value.trim();
  if(!content) return;
  await fetch(API_BASE+"/message/send",{
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},
    body:JSON.stringify({threadId:currentThread,content,username:document.getElementById("username").value})
  });
  chatInput.value="";
  loadMessages(currentThread);
}

// ===== New Chat Button =====
document.getElementById("newChatBtn").onclick = async ()=>{
  const name = prompt("Enter thread name");
  if(!name) return;
  const members = prompt("Enter usernames to add (comma separated)").split(",").map(s=>s.trim());
  const res = await fetch(API_BASE+"/threads/create",{
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},
    body:JSON.stringify({name,members})
  }).then(r=>r.json());
  if(res.success) loadThreads();
  else alert("Failed to create thread");
}

// ===== Clear Chat =====
document.getElementById("clearChatBtn").onclick = ()=>{
  if(confirm("Clear chat body?")){
    chatBody.innerHTML="";
  }
}
</script>

</body>
</html>
